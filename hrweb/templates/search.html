{% extends "base.html" %}
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <title>Хочу Работу</title>
</head>

<body>
    {% block header_down %}
    <div class="filters-info">        
        <div class="input-container">
            <div class="search-container">
                <div class="search-input">
                    <form id="search-form" method="GET" action="{% url 'search' %}">
                        <input type="text" id="search" name="search" placeholder="Найти вакансию" value="{{ search_query|default_if_none:'' }}">
                        <img id="search-submit" src="{% static 'hrweb/files/arrow.png' %}" class="toggle-search" alt="Искать">
                    </form>
                    <!-- <script>
                        document.addEventListener("DOMContentLoaded", function() {
                            const searchSubmit = document.getElementById("search-submit");
                            const searchForm = document.getElementById("search-form");
                    
                            searchSubmit.addEventListener("click", function() {
                                searchForm.submit();
                            });
                        });
                    </script>
                    <img src="{% static 'hrweb/files/filters.png' %}" class="toggle-filters" alt="Доп фильтры"> -->
                </div>
            </div>
            
        </div>
        
    </div>

    <div id="filters-panel" class="filters-panel hidden">
        <div class="filter">
            <label for="experience">Опыт работы</label>
            <div class="radio-buttons">
                <input type="radio" id="novar" name="experience" value="novar">
                <label for="exp1">Не имеет значения</label><br>
                <input type="radio" id="noexp" name="experience" value="noexp">
                <label for="exp2">Нет опыта</label><br>
                <input type="radio" id="onetothreeexp" name="experience" value="onetothreeexp">
                <label for="exp2">От 1 года до 3 лет</label><br>
                <input type="radio" id="morethanthreeexp" name="experience" value="morethanthreeexp">
                <label for="exp2">Более 3 лет</label><br>
            </div>
        </div>
        <div class="filter">
            <label for="employment-type">Тип занятости</label>
            <div class="radio-buttons">
                <input type="radio" id="full-time" name="employment-type" value="full-time">
                <label for="full-time">Полная занятость</label><br>
                <input type="radio" id="part-time" name="employment-type" value="part-time">
                <label for="part-time">Частичная занятость</label><br>
                <input type="radio" id="volonter" name="employment-type" value="volonter">
                <label for="part-time">Волонтерство</label><br>
                <input type="radio" id="stazhirovka" name="employment-type" value="stazhirovka">
                <label for="part-time">Стажировка</label><br>
            </div>
        </div>
        <div class="filter">
            <label for="work-schedule">График работы</label>
            <div class="radio-buttons">
                <input type="radio" id="gibkiy" name="work-schedule" value="gibkiy">
                <label for="schedule1">Гибкий график</label><br>
                <input type="radio" id="full" name="work-schedule" value="full">
                <label for="schedule2">Полный день</label><br>
                <input type="radio" id="smen" name="work-schedule" value="smen">
                <label for="schedule2">Сменный график</label><br>
                <input type="radio" id="vahta" name="work-schedule" value="vahta">
                <label for="schedule2">Вахтовый метод</label><br>
            </div>
        </div>
        <div class="filter">
            <label for="show-vacancies">Выводить вакансии</label>
            <div class="radio-buttons">
                <input type="radio" id="show-all" name="show-vacancies" value="show-all">
                <label for="show-all">За все время</label><br>
                <input type="radio" id="show-month" name="show-vacancies" value="show-new">
                <label for="show-new">За месяц</label><br>
                <input type="radio" id="show-week" name="show-vacancies" value="show-new">
                <label for="show-new">За неделю</label><br>
                <input type="radio" id="show-day" name="show-vacancies" value="show-new">
                <label for="show-new">За сутки</label><br>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const filtersToggle = document.querySelector(".toggle-filters");
            const filtersPanel = document.querySelector("#filters-panel");
                        
            filtersToggle.addEventListener("click", function() {
                filtersPanel.classList.toggle("hidden");
            });
        });
    </script>
    {% endblock %}

    {% block info %}
    <div class="content-wrapper">
        <div class="filters-container">
            <div class="filters-vacancy">
                <div class="filters-group-name">
                    <span class="group-name">
                        <legend>График работы</legend>
                    </span>
                </div>
                <div class="filters-group-items">
                    <ul class="group-items-ul">
                        <li class="item-li">
                            <label class="item-checkbox-label">
                                <input name="check_sched" class="item-checkbox-element" type="checkbox" value="Полный день">
                                <span class="item-checkbox-text">
                                    <span>Полный день</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-checkbox-label">
                                <input name="check_sched" class="item-checkbox-element" type="checkbox" value="От 4 часов в день">
                                <span class="item-checkbox-text">
                                    <span>От 4 часов в день</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-checkbox-label">
                                <input name="check_sched" class="item-checkbox-element" type="checkbox" value="Не полный день">
                                <span class="item-checkbox-text">
                                    <span>Не полный день</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-checkbox-label">
                                <input name="check_sched" class="item-checkbox-element" type="checkbox" value="Сменный график">
                                <span class="item-checkbox-text">
                                    <span>Сменный график</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-checkbox-label">
                                <input name="check_sched" class="item-checkbox-element" type="checkbox" value="Гибкий график">
                                <span class="item-checkbox-text">
                                    <span>Гибкий график</span>&nbsp;
                                </span>
                            </label>
                        </li>
                    </ul>
                </div>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                <script>
                    function handleShedChange() {
                        var selectedShed = $('input[name="check_sched"]:checked').val();
                        console.log("Selected shed level:", selectedShed);
                        var searchQuery = $('input[name="search"]').val(); 
                        var currentPage = $('.pagination').find('.current').text(); // Получаем текущий номер страницы
                        $.ajax({
                            url: window.location.href,
                            type: 'GET',
                            data: {
                                search: searchQuery,
                                'schedule[]': $('input[name="check_sched"]:checked').map(function(){
                                    return $(this).val();
                                }).get(),
                                page: currentPage // Передаем текущий номер страницы в запрос
                            },
                            success: function(data) {
                                $('.vacancies').html($(data).find('.vacancies').html());
                                $('.pagination').html($(data).find('.pagination').html());
                            }
                        });
                    }
                
                    $(document).ready(function() {
                        $('input[name="check_sched"]').change(handleShedChange);
                    });
                </script>

                <div class="filters-group-name">
                    <span class="group-name">
                        <legend>Уровень дохода</legend>
                    </span>
                </div>
                <div class="filters-group-items">
                    <ul class="group-items-ul">
                        <li class="item-li">
                            <label class="item-radio-label">
                                <input name="income_level" class="item-radio-element" type="radio">
                                <span class="item-radio-text">
                                    <span>Не имеет значения</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-radio-label">
                                <input name="income_level" class="item-radio-element" type="radio" value="30000">
                                <span class="item-radio-text">
                                    <span>от 30 000</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-radio-label">
                                <input name="income_level" class="item-radio-element" type="radio" value="50000">
                                <span class="item-radio-text">
                                    <span>от 50 000</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-radio-label">
                                <input name="income_level" class="item-radio-element" type="radio" value="100000">
                                <span class="item-radio-text">
                                    <span>от 100 000</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-radio-label">
                                <input name="income_level" class="item-radio-element" type="radio" value="150000">
                                <span class="item-radio-text">
                                    <span>от 150 000</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        <li class="item-li">
                            <label class="item-radio-label">
                                <input name="income_level" class="item-radio-element" type="radio" value="200000">
                                <span class="item-radio-text">
                                    <span>от 200 000</span>&nbsp;
                                </span>
                            </label>
                        </li>
                    </ul>               
                </div>
                

                <div class="filters-group-name">
                    <span class="group-name">
                        <legend>Регион</legend>
                    </span>
                </div>
                <div class="filters-group-items" style="display: inline-block;">
                    <ul class="group-items-ul">
                        {% for area in all_areas %}
                        <li class="item-li{% if forloop.counter > 5 %} hidden{% endif %}">
                            <label class="item-checkbox-label">
                                <input name="region" class="item-checkbox-element" type="checkbox" value="{{ area }}">
                                <span class="item-checkbox-text">
                                    <span>{{ area }}</span>&nbsp;
                                </span>
                            </label>
                        </li>
                        {% endfor %}
                    </ul>
                    {% if all_areas|length > 5 %}
                    <div class="show-all-link">
                        <a href="#" id="toggleRegions">Показать все</a>
                    </div>
                    {% endif %}
                </div>
                <div id="regionSlider" style="display: none; background-color: #CCCCCC; width: 10px; height: 100px; margin-left: 10px; float: right;"></div>
                
                <script>
                    function handleRegionChange() {
                        var selectedShed = $('input[name="region"]:checked').val();
                        console.log("Selected Region level:", selectedShed);
                        var searchQuery = $('input[name="search"]').val(); 
                        $.ajax({
                            url: window.location.href,
                            type: 'GET',
                            data: {
                                search: searchQuery,
                                'area[]': $('input[name="region"]:checked').map(function(){
                                    return $(this).val();
                                }).get()
                            },
                            success: function(data) {
                                $('.vacancies').html($(data).find('.vacancies').html());
                            }
                        });
                    }
                
                    $(document).ready(function() {
                        $('input[name="region"]').change(handleRegionChange);
                    });
                </script>
                <script>
                    document.addEventListener("DOMContentLoaded", function() {
                        var slider = document.getElementById("regionSlider");
                        var sliderHandle = document.createElement("div");
                        sliderHandle.className = "ui-slider-handle";
                        slider.appendChild(sliderHandle);
                
                        var handleRegionChange = function() {
                            var selectedShed = document.querySelector('input[name="region"]:checked').value;
                            console.log("Selected Region level:", selectedShed);
                            var searchQuery = document.querySelector('input[name="search"]').value;
                            // Реализуйте ваш AJAX запрос здесь
                        };
                
                        var updateSlider = function(visibleItems) {
                            var itemLis = document.querySelectorAll('.item-li');
                            for (var i = 0; i < itemLis.length; i++) {
                                if (i < visibleItems) {
                                    itemLis[i].classList.remove('hidden');
                                } else {
                                    itemLis[i].classList.add('hidden');
                                }
                            }
                        };
                
                        var sliderChange = function(event, ui) {
                            var visibleItems = ui.value;
                            updateSlider(visibleItems);
                        };
                
                        var initSlider = function() {
                            var sliderOptions = {
                                orientation: "vertical",
                                range: "min",
                                value: 5,
                                min: 1,
                                max: 5, // Значение по умолчанию для показа только первых 5 городов
                                slide: sliderChange
                            };
                            $(slider).slider(sliderOptions);
                            $(slider).slider("pips", {
                                rest: "label",
                                step: 1
                            });
                        };
                
                        var showAll = function() {
                            var buttonText = this.textContent;
                            this.textContent = (buttonText == 'Показать все' ? 'Скрыть' : 'Показать все');
                            $('#regionSlider').toggle();
                            if (buttonText == 'Показать все') {
                                var maxCities = document.querySelectorAll('li.item-li').length;
                                $(slider).slider("option", "max", maxCities).slider("value", maxCities);
                                updateSlider(maxCities);
                            } else {
                                $(slider).slider("option", "max", 5).slider("value", 5);
                                updateSlider(5);
                            }
                        };
                
                        document.querySelectorAll('input[name="region"]').forEach(function(input) {
                            input.addEventListener("change", handleRegionChange);
                        });
                
                        document.getElementById('toggleRegions').addEventListener("click", showAll);
                
                        initSlider();
                    });
                </script>

                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                <script>
                    // Функция для отправки AJAX запроса на сервер при изменении состояния радио кнопок уровня дохода
                    function handleIncomeLevelChange() {
                        var selectedIncomeLevel = $('input[name="income_level"]:checked').val();
                        console.log("Selected income level:", selectedIncomeLevel);
                        var searchQuery = $('input[name="search"]').val(); // Получаем текущее значение поискового запроса
                        // Отправляем AJAX запрос на сервер
                        $.ajax({
                            url: window.location.href,
                            type: 'GET',
                            data: {
                                search: searchQuery,
                                income_level: selectedIncomeLevel
                            },
                            success: function(data) {
                                console.log("Received Income data:", data); 
                                // Обновляем только список вакансий без перезагрузки страницы
                                $('.vacancies').html($(data).find('.vacancies').html());
                            }
                        });
                    }
                
                    // Добавляем обработчик события на изменение состояния радио кнопок уровня дохода
                    $(document).ready(function() {
                        $('input[name="income_level"]').change(handleIncomeLevelChange);
                    });
                </script>
            </div>
        </div>

        <div class="vacancies-container">
            <div class="vacancies">
                {% for vacancy in vacancies %}
                <div class="vacancy-box">
                    <div class="name_vac">{{vacancy.name}}</div> 
                    <div class="info_vac_salary"><strong>{{ vacancy.salary }} ₽</strong></div> 
                    <div class="info_vac_empl">{{ vacancy.employer }}</div> 
                    <div class="info_vac_area">{{ vacancy.area }}</div>
                    <button class="btn-more-info">Подробнее</button>
                    <button class="btn-call">Откликнуться</button>
                </div>
                {% empty %}
                <p>Нет результатов для "{{ query }}".</p>
                {% endfor %}
            </div>
    
        </div>
        
    </div>
    <div class="pagination">
        <span class="step-links">
            {% if previous_page_number %}
                {% if show_first_page_link %}
                    <a href="?page={{ first_page_number }}">{{ first_page_number }}&nbsp;&nbsp;...</a>
                {% endif %}
                <a href="?page={{ previous_page_number }}">{{ previous_page_number }}</a>
            {% endif %}
        
            <span class="current">
                <a href="?page={{ vacancies.number }}">{{ vacancies.number }}</a>
            </span>
        
            {% if next_page_number %}
                <a href="?page={{ next_page_number }}">{{ next_page_number }}</a>
                {% if show_last_page_link %}
                    <a href="?page={{ total_pages }}">...&nbsp;&nbsp;{{ total_pages }}</a>
                {% endif %}
            {% endif %}
        </span>
    </div>

    
    
    
    {% endblock %}

</body>
</html>





